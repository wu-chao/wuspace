<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<title>AHPU高校论坛系统注册页面</title>
	<link th:href="@{/resources/css/login.css}" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="all">
	<div id="login_container">
		<div id="login-head">
			<h1>AHPU高校论坛系统注册</h1>
		</div>
		<form action="login" method="post">
			<p id="message" style="font-family:'微软雅黑';font-size:14px;color:red;"></p>
			<ul>
				<li>
					<i class="icon user"></i>
					<input type="text" name="account" id="account" autocomplete="off"  placeholder="请输入用户名或邮箱账号" class="text"/>
				</li>
				<li>
					<i class="icon lock"></i>
					<input type="password" name="password" id="password" autocomplete="off" maxlength="16" placeholder="请输入用户密码"/> 
				</li>
				<li>
					<i class="icon lock"></i>
					<input type="password" name="repassword" id="repassword" autocomplete="off" maxlength="16" placeholder="请再次输入用户密码"/> 
				</li>
			</ul>
			<div class="clear"></div>
			<div id="login_operations" style="padding-top: 2em;">
				<input type="button" onclick="register()" value="注册"/>
				<a id="login_register" th:href="@{/users/login}">已有账号？点此登录</a>
			</div>
		</form>
	</div>					
	<div id="footer">
		<p>Copyright &copy; 2016 by wuchao</p>
	</div>
</div>
<script type="text/javascript" th:src="@{/resources/js/jquery-1.11.1.min.js}"></script>
<script type="text/javascript" th:src="@{/resources/js/cookie.js}"></script>
<script type="text/javascript" th:src="@{/resources/js/utils.js}"></script>
<script type="text/javascript">
	/*<![CDATA[*/
	var user_id = 0;
	
	$("#account").blur(function(){
		var account = $(this).val();
		blurAccount(account);
	});
	
	$("#password").blur(function(){
		var password = $(this).val();
		if(password.length < 6){
			showMessage("密码位数小于6位!");
			return;
		}
	});
	
	$("#repassword").blur(function(){
		var password = $("#password").val();
		var repassword = $(this).val();
		if(repassword.length < 6){
			showMessage("密码位数小于6位!");
			return;
		}
		if(password != repassword){
			showMessage("两次输入的密码不一致!");
			return;
		}
	}); 
	           
	function register(){
		var account = $("#account").val();
		var password = $("#password").val();
		var repassword = $("#repassword").val();
		if(isEmpty(account)){
			$("#account").focus();
			showMessage("请输入账号!");
			return;
		}
		if(isEmpty(password)){
			$("#password").focus();
			showMessage("请输入密码!");
			return;
		};
		if(password.length < 6){
			$("#password").focus();
			showMessage("密码位数小于6位!");
			return;
		}
		if(isEmpty(repassword)){
			$("#repassword").focus();
			showMessage("请输入确认密码!");
			return;
		};
		if(repassword.length < 6){
			$("#repassword").focus();
			showMessage("密码位数小于6位!");
			return;
		}
		if(repassword != password){
			$("#repassword").focus();
			showMessage("两次输入的密码不一致!");
			return;
		}
		
		$.ajax({
			type:"post",
			url:"/blog/users/register",
			data:{"account" : account,"password":password},
			success:function(data){
				if(data.msg.trim() == "error"){
					$("#account").focus();
					showMessage("注册出错!");
					return;
				}
				if(data.msg.trim() == "isexist"){
					$("#account").focus();
					showMessage("账号已存在!");
					return;
				}
				else{
					window.location.href = "/blog/users/login";
				}
			}
		});
	};
	
	/*账号输入框失去焦点*/
	function blurAccount(account){
		if(isEmpty(account)){
			return;
		}
		$.ajax({
			type:"get",
			url:"/blog/users/validate",
			data:{"account":account},
			success:function(data){
				user_id = parseInt(data);
				if(user_id != 0){
					showMessage("账号已存在!");
				}
			}
		});
	}
	
	/*显示提示信息*/
	function showMessage(message){
		$("#message").show().html(message).fadeOut(3000);
	}
	/*]]>*/
</script>
</body>
</html>