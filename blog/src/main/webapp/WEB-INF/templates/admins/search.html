<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>AHPUT高校论坛首页</title>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
    <link type="text/css" rel="stylesheet" th:href="@{/css/base.css}"/>
    <link type="text/css" rel="stylesheet" th:href="@{/css/posts.css}"/>
    <link type="text/css" rel="stylesheet" th:href="@{/css/paging.css}"/>
    <style>
	    body {
			padding: 0px;
			margin: 0px;
			background: #F0F0F0;
			font-family: "微软雅黑";
			font-size: 12px;
		}
		/*body部分开始*/
		#body #search {
			background:#E8EFF5;
			width:1000px;
			height:50px;
			position:relative;
		}
		#search #search_input{
			width:470px;
			height:28px;
			padding: 0 8px;
			border:2px solid #E9EAE9;
			position:absolute;
			top:8px;
			left:10px;
		}
		#search #search_icon {
			display:block;
			width:28px;
			height:28px;
			position:absolute;
			top:10px;
			left:508px;
		}
		#editor_container {
			width:696px;
			margin:32px 12px 0 12px;
		}
		#editor_container #title {
			width:678px;
			height:24px;
			margin-bottom:4px;
			padding:2px 2px 2px 12px;
			border:2px solid #E9EAE9;
		}
		#editor_container #status_bar {
			width:696px;
			height:36px;
			margin-top: 8px;
			position:relative;
		}
		#editor_container #words_num {
			position: absolute;
			top: 8px;
			right: 128px;
		}
		#editor_container #post_btn {
			width: 76px;
			height: 32px;
			background: #2BA3E5;
			border-radius: 4px;
			border: 1px solid #E9EAE9;
			color:#fff;
			position:absolute;
			top:0px;
			right:4px;
		}
		#editor_container #post_btn:hover{
			background:#1582CE;
		}
		/*body部分结束*/
    </style>
  </head>
  <body>
  	<div id="all">
	 	<!-- header部分开始 -->
		<div id="header">
			<div id="logo">
				<a th:href="${#mvc.url('BC#adminPosts').build()}"><img th:src="@{/images/logo.png}"/></a>
			</div>
			<div id="navigation">
				<ul>
					<li id="user">
						<input id="user_id" type="hidden" th:attr="data-id = ${session.loginAdmin.id}"/>
						<a class="nickname" th:text="${session.loginAdmin.nickname}"></a>
						<ul id="user_list">
							<li>
								<a th:href="${#mvc.url('UC#show').arg(0, session.loginAdmin.id).build()}" target="_blank">个人中心</a></li>
							<li>
								<a th:href="${#mvc.url('UC#logout').arg(0, session.loginAdmin.id).build()}">退出</a></li>
						</ul>
					</li>
					<li><a class="table" th:href="${#mvc.url('UC#adminUsers').build()}">用户</a></li>
					<li><a class="table" th:href="${#mvc.url('BC#adminPosts').build()}">帖子</a></li>
					<li><a class="table" th:href="${#mvc.url('NC#notices').arg(3, session.loginAdmin.id).build()}">公告</a></li>
				</ul>
			</div>
		</div>
		<!-- header部分结束 -->
		
		<!-- body部分开始 -->
		<div id="body">
			<form id="search" th:action="@{/admins/search}" method="get">
				<input type="text" name="title" th:value="${search}" id="search_input" placeholder="请输入搜索内容"/>
				<input type="submit" id="search_icon" th:attr="style='background:url('+@{/images/search.png}+') no-repeat'" value=""></input>
			</form>
			
			<ul id="posts">
				<li class="post" th:each="postSearch : ${postSearchPage}" th:if="${postSearch != null}">
					<div class="post_title">
						<a th:utext="${postSearch.title}" th:href="${#mvc.url('BC#adminShow').arg(0, postSearch.id).build()}">标题</a>&nbsp;
					</div>
					<div class="post_nr" th:utext="${postSearch.content}">内容</div>
					<div class="post_info">
						<!-- 作者 -->
						<i th:attr="style='background:url('+@{/images/post_author.png}+') no-repeat'"></i>
						<a class="post_author" target="_blank" th:href="${#mvc.url('UC#adminShow').arg(0, postSearch.authorId).build()}" th:utext="${postSearch.author}">作者</a>&nbsp;&nbsp;
						<!-- 时间 -->
						<i th:attr="style='background:url('+@{/images/post_time.png}+') no-repeat'"></i>
						<span class="post_time" th:text="${postSearch.publishTime}">发表时间</span>&nbsp;&nbsp;
						<!-- 浏览次数 -->
						<i th:attr="style='background:url('+@{/images/post_view_times.png}+') no-repeat'"></i>
						<span th:text="${postSearch.viewedTimes}">浏览次数</span>&nbsp;&nbsp;
						<!-- 删除 -->
						<span class="post_delete">
							<input type="hidden" class="post_id" th:attr="data-id=${postSearch.id}"/>
							<a th:text="删除" onclick="deletePost(this)">删除</a>
						</span>
					</div>
				</li>
			</ul>
				
			<!-- 分页 -->
			<div id="paging" th:if="${totalPages >= 2}">
				<a th:href="${#mvc.url('APSC#search').arg(0, 0).arg(2, 0).build()}">首页</a>
				<a th:if="${curPage - 1 >= 0}" th:href="${#mvc.url('APSC#search').arg(0, firstPage).arg(1, curPage).arg(2, curPage - 1).arg(3, search).build()}">上一页</a>
				<a class="no_hover" th:if="${curPage - 1 lt 0}">上一页</a>
				<a th:if="${firstPage le totalPages - 1}" th:attr="class = ${curPage == firstPage ? 'clicked' : ''}"
					th:href="${#mvc.url('APSC#search').arg(0, firstPage).arg(1, curPage).arg(2, firstPage).arg(3, search).build()}" th:text="${firstPage + 1}">1</a>
				<a th:if="${firstPage + 1 le totalPages - 1}" th:attr="class = ${curPage == firstPage + 1 ? 'clicked' : ''}"
					th:href="${#mvc.url('APSC#search').arg(0, firstPage).arg(1, curPage).arg(2, firstPage + 1).arg(3, search).build()}" th:text="${firstPage + 2}">2</a>
				<a th:if="${firstPage + 2 le totalPages - 1}" th:attr="class = ${curPage == firstPage + 2 ? 'clicked' : ''}"
					th:href="${#mvc.url('APSC#search').arg(0, firstPage).arg(1, curPage).arg(2, firstPage + 2).arg(3, search).build()}" th:text="${firstPage + 3}">3</a>
				<a th:if="${firstPage + 3 le totalPages - 1}" th:attr="class = ${curPage == firstPage + 3  ? 'clicked' : ''}"
					th:href="${#mvc.url('APSC#search').arg(0, firstPage).arg(1, curPage).arg(2, firstPage + 3).arg(3, search).build()}" th:text="${firstPage + 4}">4</a>
				<a th:if="${firstPage + 4 le totalPages - 1}" th:attr="class = ${curPage == firstPage + 4  ? 'clicked' : ''}"
					th:href="${#mvc.url('APSC#search').arg(0, firstPage).arg(1, curPage).arg(2, firstPage + 4).arg(3, search).build()}" th:text="${firstPage + 5}">5</a>
				<a th:if="${curPage + 2 le totalPages}" th:href="${#mvc.url('APSC#search').arg(0, firstPage).arg(1, curPage).arg(2, curPage + 1).arg(3, search).build()}">下一页</a>
				<a class="no_hover" th:if="${curPage + 2 > totalPages}">下一页</a>
				<a th:href="${#mvc.url('APSC#search').arg(0, totalPages - 6).arg(2, totalPages - 1).arg(3, search).build()}">尾页</a>
				<a class="no_hover">共<span th:text="${totalPages}"></span>页</a>
			</div>			
		</div>
		<!-- body部分结束-->
		
		<!-- footer部分开始 -->
		<div id="footer">
			<p>Copyright &copy; 2016 by wuchao</p>
		</div>
		<!-- footer部分结束 -->
  	</div>
		
	<script type="text/javascript" th:src="@{/js/jquery-1.11.1.min.js}"></script>
 	<script type="text/javascript">
	/*<![CDATA[*/
		$("#user").mouseover(function(){
			$("#user_list").show();
		}).mouseleave(function(){
			$("#user_list").hide();
		});
		
		/*帖子搜索*/
		
   		/*初始化内容列表*/
		$("#posts").find(".post").each(function(){
			var post_div = $(this).find(".post_nr");
			var content_text = $(post_div).text();
			var imgs = $(post_div).find("img");
			var len = imgs.length;
			if(len >= 1){
				var count = 0;
				var img_div = document.createElement("div");
				img_div.className = "map_div";
				for(var i=0; i<len && count<3; i++, count++){
					var imgDom = imgs[i];
					var imgSrc = imgDom.src;
					if(isEmpty(imgSrc)){
						imgSrc = $(imgDom).attr("src");
					}
					var realWidth = imgDom.width;
					var realHeight = imgDom.height;
					if(realWidth >= 150 || realHeight >= 105){
						var img = document.createElement("img");
						img.src = imgSrc;
						img.height = 105;
						img.width = 150;
						img.className = "map";
						img_div.appendChild(img);
					}
				}
				content_text = content_text.substr(0, 180);
				post_div.text(content_text);
				if($(img_div).find("img").length >= 1){
					post_div.append(img_div);
				}
			}else{
				post_div.text(content_text);
			}
		});

		/*删帖*/
		function deletePost(obj) {
			var postId = $(obj).prev(".post_id").data("id");
			$.ajax({
				type:"get",
				url:"/cblog/posts/"+postId+"/delete",
				success:function(data){
					if(data.msg.trim() == "success"){
						$(obj).parents("li").slideUp(1000, function(){});
					}else{
						alert("删除失败");
					}
				}
			});
		}

		//判断字符串是否为空
	 	function isEmpty(str){
			if (str == '' || str == null || str == undefined) {
				return true;
			} else {
				return false;
			}
		}
		
		function getLocalTime(time) {     
			var date = new Date(time);
			Y = date.getFullYear() + '-';
			M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
			D = date.getDate() < 10 ? '0'+date.getDate()+' ' : date.getDate() + ' ';
			h = date.getHours() < 10 ? '0'+date.getHours()+':' : date.getHours() + ':';
			m = date.getMinutes() < 10 ? '0'+date.getMinutes()+':' : date.getMinutes() + ':';
			s = date.getSeconds() < 10 ? '0'+date.getSeconds() : date.getSeconds(); 
			return(Y+M+D+h+m+s); 
  		}
	/*]]>*/
 	</script>
  </body>
</html>
